## 第一階段
# **VGA 顯示**

---

## **1. 簡介**
本報告介紹基於 VHDL 的 VGA 顯示模組設計，模組通過時脈分頻與同步信號生成，支持多種分辨率顯示模式（640x480、800x600、1024x768），並通過像素時脈來驅動 VGA 顯示設備。該設計可作為 FPGA 開發中 VGA 控制器的基礎模組，廣泛應用於顯示系統、遊戲設備以及基於 VGA 的教學系統。

---

## **2. 設計背景與功能**

### **2.1 設計目標**
實現一個靈活的 VGA 控制模組，具有以下功能：
1. **支援多種分辨率模式**：
   - 640x480 @ 60Hz
   - 800x600 @ 60Hz
   - 1024x768 @ 60Hz
2. **生成 VGA 同步信號**：
   - 包括水平同步信號（`h_sync`）與垂直同步信號（`v_sync`）。
3. **顯示顏色控制**：
   - 支援 `red_out`、`green_out` 及 `blue_out` 輸出，控制 8 位元顯示顏色輸出。
4. **靈活切換顯示模式**：
   - 通過 `mode` 信號選擇，不同模式的像素時脈與行列計數可無縫切換。
5. **屏幕圖形顯示功能**：
   - 圖形的判定及顯示基於 "是否在畫面內" 的條件進行動態運算。

---

### **2.2 系統接口**

#### **輸入接口**
| **名稱**     | **描述**                       |
|--------------|--------------------------------|
| `i_clk`      | 全局時脈信號                  |
| `i_rst`      | 系統復位信號（低有效）         |
| `mode`       | 顯示模式選擇：2 位輸入         |

#### **輸出接口**
| **名稱**        | **描述**                       |
|------------------|--------------------------------|
| `h_sync`         | 水平同步信號                 |
| `v_sync`         | 垂直同步信號                 |
| `red_out`        | 紅色顯示輸出信號，4 位       |
| `green_out`      | 綠色顯示輸出信號，4 位       |
| `blue_out`       | 藍色顯示輸出信號，4 位       |


---

### **3 核心模組描述**

#### **3.1 多分辨率選擇**
使用 `mode` 控制信號實現分辨率動態切換。支持四種顯示模式設置：

| **分辨率模式** | **水平像素** | **水平同步參數** | **垂直像素** | **垂直同步參數** |
|-----------------|-------------|------------------|-------------|------------------|
| 640x480         | 640         | `h_fp=16, h_pulse=96, h_bp=48`    | 480         | `v_fp=11, v_pulse=2, v_bp=31`    |
| 800x600         | 800         | `h_fp=56, h_pulse=120, h_bp=64`   | 600         | `v_fp=37, v_pulse=6, v_bp=23`    |
| 1024x768        | 1024        | `h_fp=24, h_pulse=136, h_bp=144`  | 768         | `v_fp=3, v_pulse=6, v_bp=29`     |

---

#### **3.2 實現 VGA 信號**
1. **水平方向計數器 (`h_count`) 與垂直方向計數器 (`v_count`)**：
   - 水平計數累加至其上限後歸零，並進一步累加垂直計數。
   - 合併用於生成同步信號及圖像顯示控制。

2. **同步信號生成 (`h_sync`, `v_sync`)**：
   - 基於計數範圍與極性（`h_pol` \ `v_pol`）生成脈衝信號，在對應時序內激活。

3. **顯示判定 (`in_image`)**：
   - 當水平方向與垂直方向計數器落在圖像區域內，信號輸出為 `'1'`，否則為 `'0'`。

---

#### **3.3 顯示顏色控制**
- 每個模式下輸出不同的顏色組合（紅/綠/藍信號的強度）。
- 定義判定算法用於顯示字符或形狀：
  - 判定當前像素點是否在圓形內（通過數學公式計算距離）。

---

## **4. 案例模組實現**

### **4.1 VGA 顯示頂層模組**
以下設計實現了與顯示分辨率相關的切換及信號生成邏輯：

```vhdl
entity VGA_Top_V2 is
  port(
    i_clk     : in  std_logic;                      
    i_rst     : in  std_logic;                        
    mode      : in  std_logic_vector(1 downto 0);    
    h_sync    : out std_logic;
    v_sync    : out std_logic;
    red_out   : out std_logic_vector(3 downto 0);
    green_out : out std_logic_vector(3 downto 0);
    blue_out  : out std_logic_vector(3 downto 0)
  );
end VGA_Top_V2;
```


---

### **4.2 VGA 信號生成子模組**
VGA 信號生成器負責水平與垂直同步信號生成，並判定圖像在顯示邊界內的狀態：

```vhdl
ENTITY VGA_Singal IS
  generic(
    h_pixels  : INTEGER  := 800;
    h_fp      : INTEGER  := 56;
    h_pulse   : INTEGER  := 120;
    h_bp      : INTEGER  := 64;
    h_pol     : STD_LOGIC := '1';
    v_pixels  : INTEGER  := 600;
    v_fp      : INTEGER  := 37;
    v_pulse   : INTEGER  := 6;
    v_bp      : INTEGER  := 23;
    v_pol     : STD_LOGIC := '1'
  );
  PORT (
    pixel_clk   : IN  STD_LOGIC;
    rst         : IN  STD_LOGIC;
    h_count_out : OUT INTEGER;
    v_count_out : OUT INTEGER;
    h_sync      : OUT STD_LOGIC;
    v_sync      : OUT STD_LOGIC;
    in_image    : OUT STD_LOGIC
  );
END VGA_Singal;
```

---

## **6. 圖片**
<img width="990" height="786" alt="image" src="https://github.com/user-attachments/assets/7bee25e0-5616-44cb-bba6-75441b9bdf26" />

# **PingPong 與 VGA 整合**

---

## **1. 簡介**
基於 VHDL 設計的 `PingPong` 與 VGA 顯示模組整合系統。該系統結合 Ping Pong 遊戲邏輯控制與 VGA 信號生成，實現了遊戲狀態顯示在 VGA 螢幕上的功能。Ping Pong 模組提供遊戲邏輯，VGA 顯示模組則負責渲染遊戲內容與得分。

---

## **2. 系統功能與增強**

### **2.1 Ping Pong 模組功能**
1. **遊戲控制**：
   - 支援左/右球移動操作（`i_swL` 和 `i_swR` 控制）。
   - 判定得分與勝利狀態（`Lwin` 和 `Rwin` 兩種遊戲結束狀態）。
2. **隨機數生成**：
   - 可選擇隨機速度模式（由 `i_random_speed` 設定）。
3. **LED 運動顯示**：
   - 使用 8 位元 LED 模擬球的位置與移動狀態。

---

### **3 模組 API**
## **3.1 PingPong 模組 API**

### **3.1.1 輸入信號**
| **名稱**           | **描述**                                   | **數據類型**              | **範例值**       |
|--------------------|--------------------------------------------|--------------------------|------------------|
| `i_clk`           | 系統全局時脈訊號（控制時序）               | `std_logic`              | `'1'`            |
| `i_rst`           | 系統復位訊號，低有效                       | `std_logic`              | `'0'`            |
| `i_swL`           | 左玩家控制按鍵                             | `std_logic`              | `'1'`            |
| `i_swR`           | 右玩家控制按鍵                             | `std_logic`              | `'0'`            |
| `i_random_speed`  | 隨機速度選擇（0:慢速，1:快速）             | `std_logic`              | `'1'`            |
| `i_mode`          | VGA 工作模式（選擇解析度）                 | `std_logic_vector(1:0)`  | `"00"`           |

### **3.1.2 輸出信號**
| **名稱**           | **描述**                                   | **數據類型**              | **範例值**       |
|--------------------|--------------------------------------------|--------------------------|------------------|
| `o_led`           | LED 狀態信號，對應球的位置顯示             | `std_logic_vector(7:0)`  | `"10000000"`     |
| `scoreL`          | 左玩家得分                                  | `std_logic_vector(3:0)`  | `"0101"`         |
| `scoreR`          | 右玩家得分                                  | `std_logic_vector(3:0)`  | `"0011"`         |

---

## **3.2 VGA 模組 API**

### **3.2.1 輸入信號**
| **名稱**           | **描述**                                   | **數據類型**              | **範例值**       |
|--------------------|--------------------------------------------|--------------------------|------------------|
| `i_clk`           | 像素時脈信號（由時鐘模塊生成）             | `std_logic`              | `'1'`            |
| `i_rst`           | VGA 重置信號，高有效                       | `std_logic`              | `'1'`            |
| `i_mode`          | 顯示模式選擇，支持解析度切換               | `std_logic_vector(1:0)`  | `"00"`           |
| `i_ball_map`      | PingPong LED 的球位置（8 位）               | `std_logic_vector(7:0)`  | `"10000000"`     |
| `scoreL`          | 左玩家得分（由 PingPong 模塊提供）         | `std_logic_vector(3:0)`  | `"0101"`         |
| `scoreR`          | 右玩家得分（由 PingPong 模塊提供）         | `std_logic_vector(3:0)`  | `"0011"`         |

### **3.2.2 輸出信號**
| **名稱**           | **描述**                                   | **數據類型**              | **範例值**       |
|--------------------|--------------------------------------------|--------------------------|------------------|
| `o_h_sync`        | VGA 水平同步信號                           | `std_logic`              | `'1'`            |
| `o_v_sync`        | VGA 垂直同步信號                           | `std_logic`              | `'1'`            |
| `o_red`           | 紅色顯示信號（4 位）                       | `std_logic_vector(3:0)`  | `"1111"`         |
| `o_green`         | 綠色顯示信號（4 位）                       | `std_logic_vector(3:0)`  | `"1111"`         |
| `o_blue`          | 藍色顯示信號（4 位）                       | `std_logic_vector(3:0)`  | `"0000"`         |

---

---


## **4. 測試**
#### **遊戲測試**
- 驗證遊戲基本功能：
  1. 左右方向按鈕 (`i_swL` 和 `i_swR`) 對球運動的影響。
  2. 模擬輸入連續得分，確保勝利條件準確判斷（`Lwin` 和 `Rwin`）。

#### **顯示測試**
- 測試 VGA 的顯示準確性：
  1. 渲染球的位置及運動軌跡。
  2. 在得分區域顯示對應的字型位圖。

### ** 測試結果**
1. 遊戲狀態反應及時，符合預期表現。
2. VGA 顯示結果如下：
   - 球的運動和得分在 VGA 螢幕正確渲染。
   - 得分數字清晰

---
## **5. 實體**
### **圖片**
   <img width="1107" height="632" alt="image" src="https://github.com/user-attachments/assets/e68e4664-c7ed-42e1-9cff-c38667ec9393" />
### **影片**
- [實際效果展示：PingPong 與 VGA 整合系統](https://youtu.be/8vFZlQKJ_cQ)
