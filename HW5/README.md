


# **第一階段：兩塊板子乒乓對打 —— 互相傳與接收資料**

---

## **1. 簡介**
本階段實現了基於 Serial Transceiver 的雙板通訊功能，兩塊板子通過一條資料線（`b_data`）和一條共地線連接，以建立可靠的點對點數據通信系統。每塊板子可以在發送和接收模式之間切換，並通過傳輸簡單的數據位元實現通信。

---

## **2. 實現目標**
- **雙向數據通信**：建立一條資料線進行雙向傳輸，並確保接收和發送準確性。
- **簡單的傳輸協議**：使用 `START_BIT(0) + DATA_BITS` 的通信協議進行數據傳遞。
- **模式切換**：支持傳輸模式和接收模式的靈活切換。
- **可配置位元**：通過調整 Generic `data_bits`，靈活支持不同的傳輸位元長度。
- **按鍵發送機制**：通過一鍵觸發完成數據從一塊板子到另一塊板子的發送功能。

---

## **3. Serial Transceiver 模組 API**

### **3.1 Generic 參數**
| **名稱**     | **描述**                       | **數據類型**  | **默認值** |
|--------------|--------------------------------|--------------|------------|
| `data_bits`  | 用於指定通信數據位元的寬度       | `integer`    | `4`        |

---

### **3.2 輸入信號**
| **名稱**          | **描述**                                     | **數據類型**              |
|-------------------|----------------------------------------------|--------------------------|
| `i_clk`          | 全局時脈信號，用於同步邏輯                   | `std_logic`              |
| `i_rst`          | 系統復位信號，低有效                         | `std_logic`              |
| `i_mode_sw`      | 工作模式切換信號，`0` = 接收，`1` = 發送      | `std_logic`              |
| `i_data`         | 發送模式下的數據，寬度由 `data_bits` 決定     | `std_logic_vector`       |
| `i_deliver_btn`  | 發送按鈕觸發信號                              | `std_logic`              |

---

### **3.3 雙向信號**
| **名稱**          | **描述**                                     | **數據類型**              |
|-------------------|----------------------------------------------|--------------------------|
| `b_data`         | 雙向資料線，用於發送及接收數據                 | `std_logic`              |

---

### **3.4 輸出信號**
| **名稱**          | **描述**                                     | **數據類型**              |
|-------------------|----------------------------------------------|--------------------------|
| `o_LED`          | 接收模式下顯示接收到的數據                    | `std_logic_vector`       |

---

## **4. 設計邏輯概述**

### **4.1 工作模式**
- **接收模式**（`i_mode_sw = 0`）：
  - 模組監視雙向資料線 `b_data`。
  - 檢測到 `START_BIT(0)` 時進入接收狀態，逐位接收數據，寬度根據 `data_bits` 設定。
  - 接收完成後，數據顯示於 `o_LED`。

- **發送模式**（`i_mode_sw = 1`）：
  - 模組在按下 `i_deliver_btn` 時，將要傳輸的數據（`i_data`）添加 `START_BIT(0)`，通過 `b_data` 發送。

---

### **4.2 傳輸協議**
- **可配置數據結構**：
  - 每次傳輸數據由 `START_BIT(0)` 起始位和可配置位數的 `DATA_BITS` 構成。
  - 位元長度由 Generic `data_bits` 靈活調整：
    - 默認值：4 bits。
    - 可擴展，例如傳輸 8 bits 或更多。

---

### **4.3 功能特性**
1. **透過 Generic 配置數據寬度**：
   - 若傳輸需求增加或減少，只需修改 `data_bits`。
   - 傳輸結構會自動適應新的位元寬度。

2. **發送數據控制**：
   - 按下按鈕（`i_deliver_btn`）後，將數據與起始位拼接後發送。

3. **接收數據控制**：
   - 持續監控資料線，當檢測到 `START_BIT(0)` 時進入接收模式，按位讀取數據。

4. **狀態機控制**：
   - `IDLE`：空閒狀態，監視工作模式和資料線。
   - `SEND`：發送模式。
   - `RECEIVE`：接收模式，直到所有數據位接收完畢。

---

## **5. 第一階段測試**

<img width="1858" height="437" alt="image" src="https://github.com/user-attachments/assets/f00adac4-8127-4ef4-acaa-08e442cfc93a" />

# **第二階段：兩塊板子乒乓對打 - 整合**

---

## **1. 簡介**
第二階段將 Serial Transceiver 模組整合進 PingPong 模組內，以實現基於通信的完整乒乓對打遊戲邏輯。PingPong 模組通過雙板點對點通信，實現球的移動、接球判斷及勝負判定。

---

## **2. 實現邏輯**

### **2.1 通信機制**
- 使用 Serial Transceiver 的 `serial_transceiver_fsm` 配合 PingPong 模組的主 FSM。
- 雙板間通過資料線完成如下功能：
  - 發送球移動狀態。
  - 接收對方的球移動或勝負資訊。

### **2.2 狀態機**
PingPong 模組新增以下狀態：
- **`MOVE_Come`**：
  - 接收到數據後，判定是否正確接球。
- **`MOVE_Out`**：
  - 發送球的移動資訊。
- **`My_win` 和 `My_loss`**：
  - 判定勝負並進一步響應。

### **2.3 球的邏輯**
- 當球移動過程中，LED 顯示球的位置。
- 成功接球時，球繼續運動；否則進入敗局處理。

---

## **3. 功能擴展**
- `Generic data_bits` 已修改為 2 位，優化遊戲專用數據結構。
- 每塊板子支持自動切換發送和接收模式。

---

## **4. 第二階段測試**

<img width="1671" height="327" alt="image" src="https://github.com/user-attachments/assets/bf33592d-3cae-4fe5-a5cf-5bbba100e475" />
<img width="847" height="355" alt="image" src="https://github.com/user-attachments/assets/8256513c-480d-4a65-b1dc-89a551f59dc9" />
